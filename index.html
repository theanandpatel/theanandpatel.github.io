<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sub 2:50 Marathon Plan - Chicago 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Chicago Marathon Inspired (Deep Blue, Vibrant Red, Neutrals) -->
    <!-- Application Structure Plan: The application is structured as an interactive dashboard to make a dense 12-week training schedule easy to digest. The core structure is based on three distinct training phases (Base, Peak, Taper) presented as main navigation tabs. This non-linear approach allows the user to easily jump between phases without scrolling through a long document. Within each phase, a dropdown menu lets the user select a specific week, displaying that week's schedule in a clear, day-by-day card format. This granular view prevents overwhelm. A key interactive element is a bar chart visualizing weekly training volume, which immediately communicates the progression, build-up, and taper periods. This structure was chosen over a simple linear report because it empowers the user to explore the plan at their own pace, understand the training load visually, and focus on the current week while still having easy access to the big picture. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Total weekly running distance for 12 weeks. -> Goal: Show training load progression and taper. -> Viz Method: Bar Chart (Chart.js/Canvas). -> Interaction: A toggle allows the user to switch the chart's y-axis and tooltips between kilometers and miles, personalizing the data display. A click on a bar navigates to the corresponding week's detailed plan. -> Justification: A bar chart is the most intuitive way to compare volume over time and visually reinforces the plan's structure (build, cutback, taper), making the progression clear. Click interaction enhances navigation.
        - Report Info: Daily workout details (distance, pace, type). -> Goal: Provide clear, daily instructions. -> Presentation Method: Structured HTML cards (divs with Tailwind). -> Interaction: The content of these cards dynamically updates based on the user's selection from the phase tabs and week dropdown. Cards are shaded based on past, current, or future days. -> Justification: Cards provide a clean, organized, and scannable format for daily tasks, which is ideal for a training plan that will be referenced frequently. Shading provides visual context of progress.
        - Report Info: Specific training paces (Easy, Marathon, Tempo, Interval). -> Goal: Define key training intensities. -> Presentation Method: Styled HTML cards in a grid layout. -> Interaction: Paces are displayed only in the selected unit (KM or MI) and dynamically update when the unit toggle is switched. A slider allows the user to set a target marathon time, which then dynamically recalculates and displays all related training paces. -> Justification: This provides an ever-present, easy-to-access reference for the user, removing ambiguity during workouts, and the unit toggle personalizes the display. The slider offers a powerful interactive tool for personalizing the pace targets based on a desired marathon finish time. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F8F8; /* Light Gray/Off-white */
            color: #333333; /* Dark Gray for main text */
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .nav-button {
            transition: all 0.3s ease;
        }
        .nav-button.active {
            background-color: #002855; /* Deep Blue */
            color: #FFFFFF;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .day-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .day-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .pace-card {
            background-color: #FFFFFF;
            border: 1px solid #E0E0E0; /* Lighter Gray border */
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            font-weight: 400;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .past-day-card {
            background-color: #EFEFEF; /* Very light gray for past */
            color: #6B7280;
        }
        .current-day-card {
            background-color: #FFFBEB; /* light yellow */
            border: 2px solid #FBBF24; /* yellow border */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Tab styling */
        .tab-button {
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            color: #333333; /* Dark Gray */
            background-color: #E0E0E0; /* Lighter Gray */
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }
        .tab-button:hover {
            background-color: #CCCCCC; /* Even lighter gray on hover */
        }
        .tab-button.active-tab {
            background-color: #FFFFFF;
            color: #002855; /* Deep Blue */
            border-bottom: 2px solid #002855; /* Deep Blue border */
            box-shadow: 0 -2px 4px rgba(0,0,0,0.05);
        }
        .tab-content {
            background-color: #FFFFFF;
            border-radius: 0 0 8px 8px;
            padding: 24px;
            border: 1px solid #E0E0E0; /* Lighter Gray border */
            border-top: none;
        }
        .tab-content h3 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: #002855; /* Deep Blue */
            margin-bottom: 12px;
            border-bottom: 1px solid #E0E0E0; /* Lighter Gray border */
            padding-bottom: 8px;
        }
        .tab-content h4 {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #D40026; /* Vibrant Red */
            margin-top: 20px;
            margin-bottom: 8px;
        }
        .tab-content p, .tab-content ul, .tab-content table {
            margin-bottom: 16px;
            color: #525252; /* Slightly lighter text for content */
            line-height: 1.6;
        }
        .tab-content ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        .tab-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            margin-bottom: 16px;
        }
        .tab-content th, .tab-content td {
            border: 1px solid #E0E0E0; /* Lighter Gray border */
            padding: 10px;
            text-align: left;
        }
        .tab-content th {
            background-color: #F0F0F0; /* Slightly darker gray for table headers */
            font-weight: 600;
            color: #333333; /* Dark Gray */
        }
        /* Added for the toggle dot size */
        .dot {
            width: 20px; /* Increased size */
            height: 20px; /* Increased size */
            left: 2px; /* Adjusted for better visual centering */
            top: 2px;  /* Adjusted for better visual centering */
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-[#002855]">Your Road to Chicago</h1>
            <p class="text-lg md:text-xl text-[#D40026] mt-2">A Sub-2:50 Marathon Training Plan</p>
        </header>

        <main>
            <!-- Introduction & Paces Section -->
            <section id="intro" class="mb-10 p-6 bg-white rounded-xl shadow-sm border border-[#E0E0E0]">
                <div class="prose max-w-none text-[#525252]">
                    <p>This 12-week plan is designed to build on your 2:57 marathon performance and get you to the Chicago finish line in under 2 hours and 50 minutes. It's structured to be challenging yet sustainable, balancing key running sessions with your existing gym routine. We'll focus on building endurance and pace-specific fitness, with built-in recovery and a holiday-week adjustment. Listen to your body, stay consistent, and get ready for a great race on October 12th!</p>
                </div>

                <div class="mt-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-[#002855]">Key Training Paces</h3>
                        <div class="flex items-center space-x-2 text-sm">
                            <span>KM</span>
                            <label for="unitToggle" class="flex items-center cursor-pointer">
                                <div class="relative">
                                    <input type="checkbox" id="unitToggle" class="sr-only">
                                    <div class="block bg-gray-200 w-10 h-6 rounded-full"></div>
                                    <div class="dot absolute bg-white rounded-full transition"></div>
                                </div>
                            </label>
                            <span>MI</span>
                        </div>
                    </div>

                    <!-- Marathon Time Slider -->
                    <div class="mt-6 mb-4">
                        <label for="marathonTimeSlider" class="block text-lg font-semibold text-[#002855] mb-2">
                            Target Marathon Time: <span id="marathonTimeDisplay" class="text-[#D40026]">2:50:00</span>
                        </label>
                        <input type="range" id="marathonTimeSlider" min="160" max="185" value="170" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-[#525252] mt-1">
                            <span>2:40</span>
                            <span>3:05</span>
                        </div>
                    </div>

                    <div id="pace-cards-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <!-- Pace cards will be generated by JS -->
                    </div>
                </div>
            </section>
            
            <!-- Main Training Plan Section -->
            <section id="training-plan" class="mb-10">
                 <div class="p-6 bg-white rounded-xl shadow-sm border border-[#E0E0E0]">
                    <h2 class="text-2xl font-bold text-center mb-6 text-[#002855]">Training Volume Overview</h2>
                    <div class="chart-container">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>
            </section>
            
            <section id="weekly-view">
                <div class="p-6 bg-white rounded-xl shadow-sm border border-[#E0E0E0]">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6 gap-4">
                        <div id="phase-nav" class="flex flex-wrap gap-2">
                            <!-- Phase buttons will be generated by JS -->
                        </div>
                        <div>
                            <label for="week-selector" class="sr-only">Select Week</label>
                            <select id="week-selector" class="w-full sm:w-auto bg-gray-50 border border-gray-300 text-[#333333] text-sm rounded-lg focus:ring-[#002855] focus:border-[#002855] block p-2.5">
                                <!-- Week options will be generated by JS -->
                            </select>
                        </div>
                    </div>
                    
                    <h3 id="week-title" class="text-2xl font-bold text-center mb-6 text-[#002855]"></h3>
                    <div id="daily-plan-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        <!-- Daily plan cards will be generated by JS -->
                    </div>
                </div>
            </section>

            <!-- New Guidance Section with Tabs -->
            <section id="additional-guidance" class="mt-10 p-6 bg-white rounded-xl shadow-sm border border-[#E0E0E0]">
                <h2 class="text-2xl font-bold text-center mb-6 text-[#002855]">In-Depth Guidance</h2>
                <div class="flex flex-wrap justify-center border-b border-[#E0E0E0] mb-6">
                    <button id="tab-nutrition" class="tab-button active-tab">Nutrition & Hydration</button>
                    <button id="tab-strength" class="tab-button">Strength Training</button>
                    <button id="tab-race" class="tab-button">Race Day Strategy</button>
                    <button id="tab-general" class="tab-button">General Advice</button>
                </div>

                <div id="tab-content-nutrition" class="tab-content">
                    <h3>Optimizing Nutrition, Hydration, and Recovery</h3>
                    <p>Optimal performance in marathon training and on race day is not solely determined by running volume and intensity; it is profoundly influenced by meticulous attention to nutrition, hydration, and recovery. These elements are the bedrock upon which physiological adaptations are built and sustained.</p>
                    
                    <h4>Daily Fueling Guidelines for High-Volume Training</h4>
                    <p>Marathon training significantly elevates the body's caloric and macronutrient demands. Adequate daily fueling is essential to replenish glycogen stores, facilitate muscle repair, and maintain overall energy levels, directly combating the "gassed" feeling experienced in previous races. Endurance athletes, in particular, have distinct nutritional requirements compared to sedentary individuals or strength athletes.</p>
                    <p>General guidelines suggest that endurance athletes should aim for:</p>
                    <ul>
                        <li><strong>Carbohydrates:</strong> 4-6 grams per pound of body weight (or 5-7 grams per kilogram of body weight) of high-quality carbohydrates daily. For a 70kg runner, this translates to approximately 350-490 grams of carbohydrates per day. This may necessitate adding an additional 500-800 calories or 125-200 grams of carbohydrates to the daily diet during heavy training. Excellent sources include whole grains, quinoa, fruits (fresh and dried), potatoes, beans, oats, pasta, and rice.</li>
                        <li><strong>Protein:</strong> 0.8-1.0 grams per pound of body weight (or 1.6-1.8 grams per kilogram of body weight). For a 70kg runner, this is roughly 112-126 grams of protein per day. Protein intake should be distributed throughout the day, including a portion before bed (e.g., casein protein) to support continuous muscle repair. Lean meats (chicken, turkey, beef), fish, eggs, dairy products (milk, Greek yogurt), soy, beans, and protein powders are suitable sources.</li>
                        <li><strong>Healthy Fats:</strong> 0.4-0.6 grams per pound of body weight daily. These are crucial for neurological recovery and reducing inflammation. Sources include salmon, flaxseed, and various nuts.</li>
                    </ul>
                    <p>The "gassed" feeling previously experienced, particularly during the half marathon, could be directly linked to insufficient daily fueling or inadequate intra-race nutrition. Consistent, high-quality daily carbohydrate intake is fundamental for preventing energy crashes during training and on race day. By ensuring glycogen stores are consistently topped off, the body is better prepared to handle the demands of intense workouts and long runs, thereby mitigating the risk of premature fatigue.</p>

                    <h4>Race Day Nutrition and Hydration Strategy</h4>
                    <p>Race day is not the time for experimentation. All fueling and hydration strategies should be meticulously practiced during long training runs to ensure the body is accustomed to the intake and to prevent gastrointestinal distress.</p>
                    <ul>
                        <li><strong>Pre-Race Meal:</strong> Consume a familiar, carbohydrate-rich meal 3-4 hours before the race. This meal should be one that has been consistently practiced before long runs. Bringing one's own preferred pre-race food is advisable.</li>
                        <li><strong>During Race Fueling:</strong> The human body can store enough glycogen for approximately two hours of aerobic activity. For a 2:50 marathon, this means that without external fuel, the runner will be operating on depleted glycogen stores for over an hour. Therefore, consistent carbohydrate intake during the race is critical to prevent "hitting the wall." The recommendation is to consume a minimum of 30-60 grams of carbohydrates per hour, which equates to about 1.5 to 3 standard energy gels. Some individuals can tolerate up to 60 grams per hour. Practicing this intake during long runs helps determine individual tolerance and preferred fuel types (gels, chews, or real food).</li>
                        <li><strong>During Race Hydration:</strong> Proper hydration is paramount. The American College of Sports Medicine (ACSM) recommends drinking 5 to 12 ounces of fluids every 15 to 20 minutes during exercise. For runs lasting longer than one hour or in hot conditions, sports beverages containing electrolytes (sodium, potassium, magnesium) are superior to water alone, as they help replenish losses from sweat and prevent dangerously low sodium levels. Weighing oneself before and after training runs is an effective method to determine individual sweat rates and fluid loss, guiding precise repletion needs.</li>
                        <li><strong>Post-Race Recovery Fueling:</strong> Recovery begins immediately after the workout. Within 30-60 minutes post-run, consume a meal or snack with a 3:1 or 4:1 carbohydrate-to-protein ratio. This optimizes glycogen repletion and supports muscle repair and growth. Examples include a smoothie with banana and protein powder, or chocolate milk. Incorporating healthy fats, particularly Omega-3 fatty acids, can further help reduce inflammation and muscle damage.</li>
                    </ul>

                    <h4>Essential Recovery Techniques</h4>
                    <p>Recovery is where the physiological adaptations from training are truly realized. Neglecting recovery can lead to accumulated fatigue, overtraining, injury, and stagnation, which could contribute to the "aggressive" feeling from previous plans and the "gassed" sensation. Recovery is not passive rest but an active process of refueling, rehydrating, and repairing the body.</p>
                    <ul>
                        <li><strong>Immediate Post-Workout Refueling:</strong> As detailed above, consuming carbohydrates and protein within 30-60 minutes after a run is critical for muscle repair and glycogen replenishment.</li>
                        <li><strong>Hydration and Electrolyte Replacement:</strong> Promptly rehydrating with water and replenishing lost electrolytes (sodium, potassium, magnesium) is essential to prevent dehydration, fatigue, and cramping. Sports drinks or electrolyte tablets can aid this process.</li>
                        <li><strong>Prioritize Deep Sleep:</strong> Adequate and deep sleep is non-negotiable for muscle repair, hormonal balance, and overall physical and mental recovery. It is during sleep that the body performs much of its repair and rebuilding processes.</li>
                        <li><strong>Active Recovery and Gentle Movement:</strong> While immediate post-marathon recovery requires a break from running (5-7 days) and deep-tissue massage, gentle movement and active recovery (e.g., walking, swimming, yoga, elliptical) can promote blood flow and aid recovery without putting excessive strain on the body. For daily training, easy runs serve as active recovery days, facilitating adaptation without additional fatigue.</li>
                        <li><strong>Gradual Return to Intensity:</strong> After a marathon, the return to running and strength training should be gradual, listening to the body's signals. This disciplined approach to recovery is as important as the training itself.</li>
                    </ul>

                    <h4>Key Table: Daily Nutrition Guidelines & Race Day Fueling Plan</h4>
                    <div class="overflow-x-auto">
                        <table>
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Guideline / Example</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Daily Nutrition Guidelines (Approx. for a 70kg Runner)</strong></td>
                                    <td></td>
                                    <td>Adjust based on individual body weight and training load.</td>
                                </tr>
                                <tr>
                                    <td><strong>Total Calories</strong></td>
                                    <td>2000-3000 kcal base + 500-800 kcal additional on heavy training days</td>
                                    <td>To meet increased demands.</td>
                                </tr>
                                <tr>
                                    <td><strong>Carbohydrates</strong></td>
                                    <td>350-490g (5-7g/kg BW)</td>
                                    <td>Prioritize whole grains, fruits, vegetables, oats, rice, pasta.</td>
                                </tr>
                                <tr>
                                    <td><strong>Protein</strong></td>
                                    <td>112-126g (1.6-1.8g/kg BW)</td>
                                    <td>Spread intake throughout the day, including a portion before bed. Lean meats (chicken, turkey, beef), fish, eggs, dairy products (milk, Greek yogurt), soy, beans, and protein powders.</td>
                                </tr>
                                <tr>
                                    <td><strong>Fats</strong></td>
                                    <td>28-42g (0.4-0.6g/kg BW)</td>
                                    <td>Healthy fats from nuts, seeds, avocado, fatty fish (Omega-3s).</td>
                                </tr>
                                <tr>
                                    <td><strong>Fluid Intake</strong></td>
                                    <td>2000-3000ml (daily) + 500-1000ml/hour of training</td>
                                    <td>Monitor urine color; weigh self before/after runs to determine sweat rate.</td>
                                </tr>
                                <tr>
                                    <td><strong>Race Day Fueling & Hydration Plan</strong></td>
                                    <td></td>
                                    <td>Practice all elements extensively during long training runs.</td>
                                </tr>
                                <tr>
                                    <td><strong>Pre-Race Meal (3-4 hours prior)</strong></td>
                                    <td>Oatmeal with banana and honey, or whole-wheat toast with jam, coffee</td>
                                    <td>Familiar, high-carb, low-fiber. Practice in training.</td>
                                </tr>
                                <tr>
                                    <td><strong>During Race (per hour)</strong></td>
                                    <td>30-60g Carbohydrates (e.g., 1.5-3 gels, chews, or sports drink)</td>
                                    <td>Start early (e.g., 30-45 min in), consistent intake.</td>
                                </tr>
                                <tr>
                                    <td><strong>During Race Hydration (every 15-20 min)</strong></td>
                                    <td>5-12 oz sports drink (containing sodium)</td>
                                    <td>Essential for electrolyte balance and preventing dehydration.</td>
                                </tr>
                                <tr>
                                    <td><strong>Post-Race Recovery (within 30-60 min)</strong></td>
                                    <td>3:1 or 4:1 Carb:Protein ratio (e.g., chocolate milk, recovery smoothie)</td>
                                    <td>Replenish glycogen, repair muscles. Include healthy fats.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-content-strength" class="tab-content hidden">
                    <h3>Strategic Integration of Strength Training</h3>
                    <p>Strength training is an indispensable component of advanced marathon preparation, offering significant benefits beyond just running.</p>
                    
                    <h4>Rationale for Strength Training</h4>
                    <p>Strength training plays a vital role in boosting running performance and preventing injuries. It enhances muscle support and improves neuromuscular coordination, making the runner more efficient. Specifically, it increases muscle stiffness and refines neuromuscular coordination, enabling runners to maintain speed with lower energy expenditure. For marathoners, the focus is not on building excessive muscle mass but on developing resilient muscles, tendons, and ligaments that can withstand the repetitive impact and prolonged stress of high-volume running. It also addresses common muscular imbalances and weaknesses (e.g., in the glutes and core) that can lead to fatigue, poor form, and injury over the 26.2-mile distance.</p>

                    <h4>Specific Recommendations for 3x/week Gym Sessions (Monday, Wednesday, Friday)</h4>
                    <p>The individual's existing schedule of three gym sessions per week (Monday, Wednesday, and Friday) aligns perfectly with the recommendations for runners who train six days a week. The key is to strategically integrate these sessions to optimize the training stimulus and minimize interference with running workouts.</p>
                    <p>When both running and strength training occur on the same day, the timing of each session is crucial. For long runs, tempo runs, or interval workouts (the "hard" running days), it is recommended to perform the run first. This ensures that the legs are fresh for the primary running stimulus, maximizing the quality and intended physiological adaptation of the key run. Conversely, on easy running days, it is often more beneficial to perform the strength training session first. This allows for a higher quality strength workout, as the muscles are not pre-fatigued from a demanding run, and the subsequent easy run can still serve its purpose of aerobic development and active recovery. By following these guidelines, strength training becomes a supportive element that enhances running performance rather than detracting from it due to accumulated fatigue.</p>

                    <h4>Recommended Exercises and Progression through Training Phases</h4>
                    <p>The strength training program should evolve throughout the training cycle, aligning with the specific demands of each phase. Emphasis should be placed on exercises that directly benefit running mechanics, injury prevention, and power generation. Focusing on core and single-leg exercises is particularly beneficial for runners.</p>
                    <ul>
                        <li><strong>Phase 1: Reestablishing Base (Weeks 1-3):</strong> During this initial phase, the focus should be on building foundational strength, improving balance and stability, and addressing any muscular imbalances that could predispose to injury. This involves higher volume lifting, typically in the 8-12 repetition range. Key exercises should emphasize unilateral (single-leg) movements, such as:
                            <ul>
                                <li>Single-Leg Calf Raises (3x10-12)</li>
                                <li>Single-Leg Deadlifts (3x8-10)</li>
                                <li>Single-Leg Deficit Squats (3x8-10/side)</li>
                                <li>Dumbbell March (3x10-12/side)</li>
                                <li>Side Plank Crunches (3x10-12/side)</li>
                            </ul>
                            This progression helps to create a robust and injury-resistant body from the ground up.
                        </li>
                        <li><strong>Phase 2: Specific Preparation (Weeks 4-9):</strong> As the running volume and intensity increase, the strength training should shift towards developing raw strength and power. This typically involves lower repetitions, in the 4-6 rep range, with heavier loads. While unilateral exercises remain beneficial, this phase can incorporate heavier bilateral lifts (e.g., squats, deadlifts) to build overall strength. The introduction of plyometrics is also recommended during this phase to improve power and explosiveness, which directly translates to improved running economy. The strategic placement of these sessions (e.g., later in the day after tempo or interval runs) ensures that the primary running workouts are performed with fresh legs.</li>
                        <li><strong>Phase 3: Peak Performance & Taper (Weeks 10-14):</strong> During the peak and taper phases, the volume of strength training should be progressively reduced. This involves decreasing the number of sets per exercise and potentially reducing the frequency to 1-2 sessions per week. The primary objective is to maintain strength and mobility without introducing additional fatigue that could compromise running performance. All strength work should be forgone entirely in the 72 hours leading up to the race to ensure maximal freshness. This reduction is a deliberate part of the tapering process, allowing the body to fully recover and consolidate its fitness gains.</li>
                    </ul>

                    <h4>Key Table: Strength Training Schedule & Key Exercises</h4>
                    <div class="overflow-x-auto">
                        <table>
                            <thead>
                                <tr>
                                    <th>Training Phase</th>
                                    <th>Frequency</th>
                                    <th>Focus / Rep Range</th>
                                    <th>Timing (relative to run)</th>
                                    <th>Monday (e.g., Lower Body)</th>
                                    <th>Wednesday (e.g., Core & Glutes)</th>
                                    <th>Friday (e.g., Full Body / Plyometrics)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Phase 1: Base (Weeks 1-3)</strong></td>
                                    <td>3x/week</td>
                                    <td>Foundational Strength, Balance, Unilateral (8-12 reps)</td>
                                    <td>Lift after easy run</td>
                                    <td>Single-Leg Calf Raises (3x10-12), Single-Leg Deadlifts (3x8-10)</td>
                                    <td>Side Plank Crunches (3x10-12/side), Glute Bridges (3x12-15)</td>
                                    <td>Single-Leg Deficit Squat (3x8-10/side), Dumbbell March (3x10-12/side)</td>
                                </tr>
                                <tr>
                                    <td><strong>Phase 2: Build (Weeks 4-9)</strong></td>
                                    <td>3x/week</td>
                                    <td>Strength, Power, Bilateral (4-6 reps), Plyometrics</td>
                                    <td>Lift after hard run (Tue/Thu) or before easy run (Mon/Wed/Fri)</td>
                                    <td>Barbell Squats (3x4-6), Romanian Deadlifts (3x4-6)</td>
                                    <td>Plank variations (3x60s), Bird-Dog (3x10/side), Cable Pull-Throughs (3x8-10)</td>
                                    <td>Box Jumps (3x5-8), Medicine Ball Slams (3x8-10), Lunges (3x6-8/side)</td>
                                </tr>
                                <tr>
                                    <td><strong>Phase 3: Peak/Taper (Weeks 10-14)</strong></td>
                                    <td>1-2x/week (reduced sets)</td>
                                    <td>Maintenance, Mobility (reduced reps/sets)</td>
                                    <td>Lift after easy run, or on rest day</td>
                                    <td>Light Goblet Squats (2x8), Single-Leg Calf Raises (2x10)</td>
                                    <td>Light Core Circuit (2-3 exercises, 2x10-15)</td>
                                    <td>Bodyweight Lunges (2x10/side), Mobility Drills</td>
                                </tr>
                                <tr>
                                    <td><strong>Race Week (Week 14)</strong></td>
                                    <td>0</td>
                                    <td>None</td>
                                    <td>Forgo 72 hours pre-race</td>
                                    <td>Rest</td>
                                    <td>Rest</td>
                                    <td>Rest</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-content-race" class="tab-content hidden">
                    <h3>Race Day Execution: Chicago Marathon Strategy</h3>
                    <p>Optimal race day execution is the culmination of weeks of dedicated training. A well-conceived strategy can make the difference between achieving a goal and falling short.</p>

                    <h4>Pacing Strategy</h4>
                    <p>For a sub 2:50 marathon, precise and disciplined pacing is paramount. The most effective strategies involve either "negative splits" or "even splits".</p>
                    <ul>
                        <li><strong>Negative Splits:</strong> This involves running the second half of the race faster than the first half. This strategy allows the body to warm up, conserve energy in the early miles, and finish strong. It is often considered the most efficient way to achieve an optimal marathon performance.</li>
                        <li><strong>Even Splits:</strong> This entails maintaining a consistent pace throughout the entire race. While challenging, it is a reliable alternative to negative splits and avoids the pitfalls of starting too fast.</li>
                    </ul>
                    <p>Conversely, the strategy of "banking time" by starting aggressively fast and hoping to hold on is strongly discouraged. This approach almost invariably leads to hitting "the wall" around miles 20-22, resulting in a significant slowdown or even walking. The runner's previous experience of feeling "gassed" during the half marathon serves as a direct warning against starting too fast in the marathon. A disciplined, conservative start is crucial for a sub 2:50 attempt, ensuring that energy reserves are managed effectively to maintain pace through the later stages of the race. The objective is to finish strong, maintaining momentum and form, rather than experiencing a dramatic fade.</p>

                    <h4>Pre-Race Routine and Mental Preparation</h4>
                    <p>Race day success extends beyond physical fitness; it encompasses meticulous mental preparation and a consistent pre-race routine to minimize variables and reduce anxiety.</p>
                    <ul>
                        <li><strong>Morning Routine Practice:</strong> It is highly recommended to practice the race morning routine during training, especially before long runs. This includes waking up at the projected race start time and consuming the planned pre-race meal. This familiarity helps to reduce stress and ensures the body is accustomed to performing at that time of day.</li>
                        <li><strong>Gear and Shoes:</strong> Avoid introducing any new gear, shoes, socks, or apparel on race day. All items should be thoroughly tested during training to prevent chafing, blisters, or discomfort. Shoes should be well-worn but not "dead".</li>
                        <li><strong>Mental Visualization:</strong> Visualize success by picturing oneself crossing the finish line strongly. Setting mini-goals throughout the race (e.g., reaching specific aid stations, maintaining pace for a certain number of miles) can help break down the daunting distance and maintain focus.</li>
                        <li><strong>Flexibility and Adaptability:</strong> While a plan is essential, maintaining a degree of flexibility on race day is important. External factors such as weather conditions, course variations, or unexpected physical sensations may necessitate minor adjustments to the pacing strategy. The ability to adapt and respond calmly to challenges is a hallmark of an experienced marathoner.</li>
                    </ul>
                </div>

                <div id="tab-content-general" class="tab-content hidden">
                    <h3>General Advice & Ongoing Development</h3>
                    <p>Achieving a sub 2:50 marathon at the Chicago Marathon on October 12th is a demanding but entirely feasible objective for this experienced runner. The strategic framework presented, rooted in a periodized, 80/20 training philosophy, provides a robust pathway for success. Key to this endeavor will be the consistent execution of the detailed weekly plan, a disciplined approach to recovery, and the strategic integration of strength training and holiday adjustments. The plan specifically addresses previous concerns about "aggressive" training by emphasizing sustainable progression and ample recovery, thereby preventing the "gassed" sensation experienced in past races.</p>

                    <h4>Importance of Flexibility and Listening to Your Body</h4>
                    <p>While this report provides a comprehensive and detailed training roadmap, it is crucial to recognize that it serves as a guide, not an immutable dogma. The individual's past experience with "aggressive" training plans underscores the importance of self-awareness and flexibility throughout the training cycle. The perception of "aggressive" is subjective; what one runner tolerates, another may find overwhelming. Therefore, the runner must be empowered to listen to their body and make real-time adjustments based on how they feel. For instance, if excessive fatigue is present, a planned tempo run might be converted into an easy run, or an extra recovery day might be taken. Improvement in endurance sports occurs as much during rest as it does during the run. This adaptive approach is a sign of intelligent training, not weakness, and is fundamental for preventing overtraining, injury and burnout, ultimately leading to more consistent and effective training in the long term.</p>

                    <h4>Recommendations for Continued Progress and Considering Professional Coaching</h4>
                    <p>For continued progression beyond this specific goal, or for highly personalized and dynamic guidance, considering professional coaching is a valuable next step. While this report provides a scientifically-backed and detailed framework, a dedicated human coach offers several unique advantages:</p>
                    <ul>
                        <li><strong>Customized Adaptation:</strong> A coach can provide real-time adjustments to the training plan based on daily feedback, physiological responses, and unforeseen circumstances such as illness, stress, or travel. This level of dynamic adaptation is difficult for a static plan to replicate.</li>
                        <li><strong>Expert Interpretation:</strong> Experienced coaches can interpret subtle body signals and training data, providing nuanced guidance that optimizes performance and minimizes injury risk.</li>
                        <li><strong>Accountability and Motivation:</strong> A coach offers consistent accountability and psychological support, which can be invaluable for maintaining motivation and adherence during challenging training blocks.</li>
                        <li><strong>Long-Term Development:</strong> For an ambitious runner consistently pushing personal limits, a coach can help develop a long-term athletic trajectory, ensuring sustainable growth and preventing plateaus or chronic issues.</li>
                    </ul>
                    <p>Reputable coaching services, such as RunDoyen or Luke Humphrey Running, offer access to highly accomplished coaches, including Olympians and national champions, who work with runners of all levels. This investment can provide the personalized oversight necessary for continued high-level performance and injury prevention, serving as a natural evolution for a runner dedicated to maximizing their potential.</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        const MILE_CONVERSION = 0.621371;

        // Make paces a mutable variable
        let paces = {
            easy: { km: "5:30-6:00", mi: "8:50-9:40" },
            marathon: { km: "4:02", mi: "6:29" },
            tempo: { km: "3:55-4:00", mi: "6:20-6:25" },
            interval: { km: "3:40-3:50", mi: "5:55-6:10" }
        };

        // Base training plan with explicit baseKm for each daily workout
        // totalKm for each week will be calculated dynamically
        const baseTrainingPlan = [
            // Week 1: Jul 21-27
            { week: 1, phase: 'Base Building', dates: 'Jul 21-27', schedule: [
                { day: 'Mon', type: 'Gym / Rest', details: 'Focus on strength training or take a full rest day.', baseKm: 0},
                { day: 'Tue', type: 'Easy Run', details: 'at an easy, conversational pace.', baseKm: 8},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 6},
                { day: 'Thu', type: 'Intervals', details: '2k WU, 6x400m @ I-Pace w/ 400m jog recovery, 2k CD.', baseKm: 8},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'at an easy pace.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'at a steady, easy pace.', baseKm: 16}
            ]},
            // Week 2: Jul 28 - Aug 3
            { week: 2, phase: 'Base Building', dates: 'Jul 28 - Aug 3', schedule: [
                { day: 'Mon', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 6},
                { day: 'Tue', type: 'Tempo Run', details: '2k WU, 5k @ T-Pace, 3k CD.', baseKm: 10},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 6},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'at a steady, easy pace.', baseKm: 18}
            ]},
            // Week 3: Aug 4-10
            { week: 3, phase: 'Base Building', dates: 'Aug 4-10', schedule: [
                { day: 'Mon', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 6},
                { day: 'Tue', type: 'Intervals', details: '2k WU, 8x600m @ I-Pace w/ 400m jog recovery, 2k CD.', baseKm: 10},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 6},
                { day: 'Thu', type: 'Easy Run + Strides', details: 'easy, finish with 6x100m strides.', baseKm: 10},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'at a steady, easy pace.', baseKm: 21}
            ]},
            // Week 4: Aug 11-17
            { week: 4, phase: 'Specific Preparation', dates: 'Aug 11-17', schedule: [
                { day: 'Mon', type: 'Gym / Rest', details: 'Focus on strength training or take a full rest day.', baseKm: 0},
                { day: 'Tue', type: 'Workout', details: '4x1200m @ 5k pace w/ 4min jog recovery.', baseKm: 8},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 6},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'easy.', baseKm: 24}
            ]},
            // Week 5: Aug 18-24
            { week: 5, phase: 'Specific Preparation', dates: 'Aug 18-24', schedule: [
                { day: 'Mon', type: 'Gym / Easy Run', details: 'easy.', baseKm: 7},
                { day: 'Tue', type: 'Workout', details: '1mi WU, 3mi @ LT2 pace, 1mi CD.', baseKm: 8},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 6},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 9},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'easy.', baseKm: 26}
            ]},
            // Week 6 (Holiday): Aug 25-31
            { week: 6, phase: 'Specific Preparation (Holiday)', dates: 'Aug 25-31', schedule: [
                { day: 'Mon', type: 'Strength (Bodyweight)', details: 'Easy run.', baseKm: 5.6},
                { day: 'Tue', type: 'Easy Run', details: 'Easy run.', baseKm: 5.6},
                { day: 'Wed', type: 'Strength (Bodyweight)', details: 'Easy run.', baseKm: 5.6},
                { day: 'Thu', type: 'Easy Run', details: 'Easy run.', baseKm: 5.6},
                { day: 'Fri', type: 'Strength (Bodyweight)', details: 'Easy run.', baseKm: 5.6},
                { day: 'Sat', type: 'Easy Run', details: 'Easy / Exploratory run.', baseKm: 14.5},
                { day: 'Sun', type: 'Rest / Active Recovery', details: 'Focus on maintenance, flexibility, and mental break.', baseKm: 0}
            ]},
            // Week 7: Sep 1-7
            { week: 7, phase: 'Specific Preparation', dates: 'Sep 1-7', schedule: [
                { day: 'Mon', type: 'Gym / Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Tue', type: 'Workout', details: '20x1 min fast/1 min jog Fartlek.', baseKm: 12},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 7},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 10},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'easy.', baseKm: 32}
            ]},
            // Week 8: Sep 8-14
            { week: 8, phase: 'Specific Preparation', dates: 'Sep 8-14', schedule: [
                { day: 'Mon', type: 'Gym / Easy Run', details: 'easy.', baseKm: 7},
                { day: 'Tue', type: 'Workout', details: '6x1k @ LT2 w/ 60s jog recovery.', baseKm: 10},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 6},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 9},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'easy.', baseKm: 29}
            ]},
            // Week 9: Sep 15-21
            { week: 9, phase: 'Specific Preparation', dates: 'Sep 15-21', schedule: [
                { day: 'Mon', type: 'Gym / Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Tue', type: 'Workout', details: '3x2 mi @ HM pace w/ 5 min jog recovery.', baseKm: 14},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 7},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 10},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'easy w/ at MP at end.', baseKm: 35}
            ]},
            // Week 10: Sep 22-28
            { week: 10, phase: 'Peak Performance', dates: 'Sep 22-28', schedule: [
                { day: 'Mon', type: 'Gym / Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Tue', type: 'Workout', details: '10k @ LT2 pace (continuous).', baseKm: 14},
                { day: 'Wed', type: 'Gym / Recovery', details: 'very slow recovery run.', baseKm: 7},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 10},
                { day: 'Fri', type: 'Gym / Rest', details: 'Final gym session of the week or rest.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 8},
                { day: 'Sun', type: 'Long Run', details: 'with 10-13km @ MP.', baseKm: 32}
            ]},
            // Week 11: Sep 29 - Oct 5
            { week: 11, phase: 'Taper & Race', dates: 'Sep 29 - Oct 5', schedule: [
                { day: 'Mon', type: 'Strength (Maintenance)', details: 'easy run.', baseKm: 5},
                { day: 'Tue', type: 'Workout', details: '3x1 mile @ MP w/ 400m jog.', baseKm: 9},
                { day: 'Wed', type: 'Strength (Maintenance)', details: 'easy run.', baseKm: 4},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 6},
                { day: 'Fri', type: 'Strength (Maintenance)', details: 'easy run.', baseKm: 3},
                { day: 'Sat', type: 'Easy Run', details: 'easy.', baseKm: 16},
                { day: 'Sun', type: 'Rest', details: 'Full rest day.', baseKm: 0}
            ]},
            // Week 12: Oct 6-12
            { week: 12, phase: 'Taper & Race', dates: 'Oct 6-12', schedule: [
                { day: 'Mon', type: 'Rest', details: 'Full rest day.', baseKm: 0},
                { day: 'Tue', type: 'Workout', details: '4x800m @ 5k pace w/ 400m jog.', baseKm: 7},
                { day: 'Wed', type: 'Easy Run', details: 'easy.', baseKm: 5},
                { day: 'Thu', type: 'Easy Run', details: 'easy.', baseKm: 6},
                { day: 'Fri', type: 'Rest', details: 'Full rest day.', baseKm: 0},
                { day: 'Sat', type: 'Easy Run', details: 'easy shakeout run.', baseKm: 8},
                { day: 'Sun', type: 'RACE DAY', details: 'CHICAGO MARATHON! Go for Sub 2:50!', baseKm: 0}
            ]}
        ];

        // This will hold the currently scaled training plan
        let currentTrainingPlan = [];

        // Global scaling factor, derived from the slider
        let globalScalingFactor = 1; // Default to 1 (2:50 target)

        document.addEventListener('DOMContentLoaded', () => {
            const unitToggle = document.getElementById('unitToggle');
            const paceCardsContainer = document.getElementById('pace-cards-container');
            const phaseNav = document.getElementById('phase-nav');
            const weekSelector = document.getElementById('week-selector');
            const dailyPlanContainer = document.getElementById('daily-plan-container');
            const weekTitle = document.getElementById('week-title');
            const chartCanvas = document.getElementById('volumeChart');
            const marathonTimeSlider = document.getElementById('marathonTimeSlider');
            const marathonTimeDisplay = document.getElementById('marathonTimeDisplay');

            let isMiles = false;
            let currentPhase = 'Base Building';
            let volumeChart;

            const phases = [...new Set(baseTrainingPlan.map(w => w.phase))];

            // Function to convert total minutes to H:MM:SS format
            function formatMinutesToHMS(totalMinutes) {
                const hours = Math.floor(totalMinutes / 60);
                const minutes = Math.floor(totalMinutes % 60);
                const seconds = Math.round((totalMinutes % 1) * 60);
                return `${hours.toString().padStart(1, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // Function to convert seconds per unit to MM:SS format
            function formatSecondsToMMSS(totalSeconds) {
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = Math.round(totalSeconds % 60);
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // Function to calculate all paces based on target marathon time in minutes
            function calculatePaces(targetMarathonMinutes) {
                const totalMarathonSeconds = targetMarathonMinutes * 60;

                const marathonKm = 42.195;
                const marathonMiles = 26.219;

                const mpSecPerKm = totalMarathonSeconds / marathonKm;
                const mpSecPerMile = totalMarathonSeconds / marathonMiles;

                // Define pace differentials in seconds relative to MP
                // These are typical relationships, can be fine-tuned based on runner's profile
                // Easy: MP + 45-75 seconds/mile (28-47 seconds/km)
                // Tempo: MP - 10-20 seconds/mile (6-12 seconds/km)
                // Interval: MP - 30-50 seconds/mile (18-31 seconds/km)
                
                // Using averages for now, can be made more dynamic if needed
                const easyDiffSecKm = 38;
                const tempoDiffSecKm = -9;
                const intervalDiffSecKm = -25;

                const easyDiffSecMile = 60; 
                const tempoDiffSecMile = -15; 
                const intervalDiffSecMile = -40; 

                return {
                    marathon: {
                        km: formatSecondsToMMSS(mpSecPerKm),
                        mi: formatSecondsToMMSS(mpSecPerMile)
                    },
                    easy: {
                        km: formatSecondsToMMSS(mpSecPerKm + easyDiffSecKm),
                        mi: formatSecondsToMMSS(mpSecPerMile + easyDiffSecMile)
                    },
                    tempo: {
                        km: formatSecondsToMMSS(mpSecPerKm + tempoDiffSecKm),
                        mi: formatSecondsToMMSS(mpSecPerMile + tempoDiffSecMile)
                    },
                    interval: {
                        km: formatSecondsToMMSS(mpSecPerKm + intervalDiffSecKm),
                        mi: formatSecondsToMMSS(mpSecPerMile + intervalDiffSecMile)
                    }
                };
            }

            // Helper to parse date strings like "Jul 21-27"
            function parseDateRange(dateRange, year) {
                const months = {
                    'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5,
                    'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
                };

                const parts = dateRange.split(' - ');
                const startParts = parts[0].split(' ');
                const startMonth = months[startParts[0]];
                const startDay = parseInt(startParts[1]);

                let startDate = new Date(year, startMonth, startDay);
                startDate.setHours(0, 0, 0, 0);

                let endDate;
                if (parts.length > 1) {
                    const endParts = parts[1].split(' ');
                    let endMonth = months[endParts[0]] !== undefined ? months[endParts[0]] : startMonth;
                    let endDay = parseInt(endParts[endParts.length - 1]);

                    endDate = new Date(year, endMonth, endDay);
                    endDate.setHours(0, 0, 0, 0);

                    if (startDate.getMonth() > endDate.getMonth()) {
                        endDate.setFullYear(year + 1);
                    }
                } else {
                    endDate = new Date(startDate);
                }
                return { startDate, endDate };
            }

            function getRelativeWeekStatus(weekData) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const currentYear = today.getFullYear();
                const { startDate, endDate } = parseDateRange(weekData.dates, currentYear);

                if (today > endDate) {
                    return 'past';
                } else if (today >= startDate && today <= endDate) {
                    return 'current';
                } else {
                    return 'future';
                }
            }

            function getRelativeDayStatus(weekData, dayIndex) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const currentYear = today.getFullYear();
                const { startDate } = parseDateRange(weekData.dates, currentYear);

                const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const planDayName = weekData.schedule[dayIndex].day;
                const planDayOfWeekIndex = daysOfWeek.indexOf(planDayName); 

                const planDate = new Date(startDate);
                const startDayOfWeekIndex = startDate.getDay();

                let daysToAdd = planDayOfWeekIndex - startDayOfWeekIndex;
                if (daysToAdd < 0) { 
                    daysToAdd += 7;
                }
                planDate.setDate(startDate.getDate() + daysToAdd);
                planDate.setHours(0, 0, 0, 0);

                if (today > planDate) {
                    return 'past';
                } else if (today.getTime() === planDate.getTime()) {
                    return 'current';
                } else {
                    return 'future';
                }
            }

            // Function to format the details string for display
            function formatDayDetails(originalDetailsText, baseKmForDay, isMiles, scalingFactor) {
                // If baseKmForDay is 0 (rest/gym day without running distance), return original details text
                if (baseKmForDay === 0) {
                    return originalDetailsText;
                }

                const scaledKm = Math.max(0, baseKmForDay * scalingFactor);
                const scaledMi = scaledKm * MILE_CONVERSION;

                let distancePart;
                if (isMiles) {
                    distancePart = `${Number.isInteger(scaledMi) ? scaledMi.toFixed(0) : scaledMi.toFixed(1)}mi`;
                } else {
                    distancePart = `${Number.isInteger(scaledKm) ? scaledKm.toFixed(0) : scaledKm.toFixed(1)}km`;
                }
                
                // Combine the calculated distance with the original descriptive text
                return `${distancePart} ${originalDetailsText}`.trim();
            }

            // Main scaling function for the training plan
            function getScaledTrainingPlan(targetMarathonMinutes) {
                const baseMarathonMinutes = 170; // 2:50:00
                // Corrected scaling factor: lower time (faster speed) means higher mileage
                globalScalingFactor = baseMarathonMinutes / targetMarathonMinutes; 

                // Deep copy the base plan to avoid modifying the original
                const scaledPlan = JSON.parse(JSON.stringify(baseTrainingPlan)); 

                scaledPlan.forEach(weekData => {
                    let weeklyScaledKm = 0;
                    weekData.schedule.forEach(dayData => {
                        let currentDayBaseKm = dayData.baseKm;
                        
                        // Only scale if baseKm is greater than 0 (i.e., it's a running day)
                        let newScaledKm = currentDayBaseKm;
                        if (currentDayBaseKm > 0) {
                            newScaledKm = Math.max(0, currentDayBaseKm * globalScalingFactor); // No rounding here, let formatDayDetails handle it
                        }
                        
                        // Note: dayData.details is NOT modified here. It's modified at render time.
                        // We just need to sum up the scaled KMs for the weekly total.
                        weeklyScaledKm += newScaledKm;
                    });
                    weekData.totalKm = weeklyScaledKm; // Set totalKm for the week dynamically
                });
                return scaledPlan;
            }


            function renderPaceCards() {
                paceCardsContainer.innerHTML = '';
                Object.entries(paces).forEach(([name, values]) => {
                    const paceValue = isMiles ? values.mi : values.km;
                    const unit = isMiles ? 'min/mi' : 'min/km';
                    const card = `
                        <div class="pace-card rounded-lg p-4 shadow-sm">
                            <h4 class="font-semibold capitalize text-gray-700">${name} Pace</h4>
                            <p class="text-2xl font-bold text-[#D40026] mt-1">${paceValue}</p>
                            <p class="text-xs text-gray-500">${unit}</p>
                        </div>
                    `;
                    paceCardsContainer.innerHTML += card;
                });
            }

            function renderPhaseNav() {
                phaseNav.innerHTML = '';
                phases.forEach(phase => {
                    const button = document.createElement('button');
                    button.textContent = phase;
                    button.className = `nav-button px-4 py-2 rounded-lg text-sm font-medium ${phase === currentPhase ? 'active' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`;
                    button.addEventListener('click', () => {
                        currentPhase = phase;
                        renderPhaseNav();
                        renderWeekSelector();
                        const firstWeekOfPhase = currentTrainingPlan.find(w => w.phase === currentPhase).week;
                        renderWeekPlan(firstWeekOfPhase);
                    });
                    phaseNav.appendChild(button);
                });
            }

            function renderWeekSelector() {
                weekSelector.innerHTML = '';
                currentTrainingPlan
                    .filter(w => w.phase === currentPhase)
                    .forEach(weekData => {
                        const option = document.createElement('option');
                        option.value = weekData.week;
                        option.textContent = `Week ${weekData.week} (${weekData.dates})`;
                        weekSelector.appendChild(option);
                    });
            }

            function renderWeekPlan(weekNumber) {
                const weekData = currentTrainingPlan.find(w => w.week === parseInt(weekNumber));
                if (!weekData) return;

                weekTitle.textContent = `Week ${weekData.week}: ${weekData.phase}`;
                dailyPlanContainer.innerHTML = '';
                weekData.schedule.forEach((dayData, index) => {
                    const tooltipText = dayData.day === 'Sun' && weekData.week === 12 
                        ? 'Trust your training. Stick to the plan. You\'ve got this!' 
                        : 'Remember to warm up before and cool down after each run.';
                    
                    const dayStatus = getRelativeDayStatus(weekData, index);
                    let cardClasses = "day-card bg-white rounded-lg p-4 border border-[#E0E0E0] shadow-sm flex flex-col";
                    if (dayStatus === 'past') {
                        cardClasses += ' past-day-card';
                    } else if (dayStatus === 'current') {
                        cardClasses += ' current-day-card';
                    }

                    const card = document.createElement('div');
                    card.className = cardClasses;
                    card.innerHTML = `
                        <div class="flex justify-between items-baseline">
                            <h4 class="font-bold text-lg text-[#333333]">${dayData.day}</h4>
                            <div class="tooltip">
                                <span class="text-xs font-semibold uppercase tracking-wider text-gray-400">${dayData.type}</span>
                                <span class="tooltiptext">${tooltipText}</span>
                            </div>
                        </div>
                        <p class="text-[#525252] mt-2 text-sm">${formatDayDetails(dayData.details, dayData.baseKm, isMiles, globalScalingFactor)}</p>
                    `;
                    dailyPlanContainer.appendChild(card);
                });
                weekSelector.value = weekNumber;
            }

            function renderChart() {
                const labels = currentTrainingPlan.map(w => `W${w.week}`);
                const data = currentTrainingPlan.map(w => isMiles ? (w.totalKm * MILE_CONVERSION).toFixed(1) : w.totalKm.toFixed(1));
                const unit = isMiles ? 'Miles' : 'Kilometers';

                const backgroundColors = currentTrainingPlan.map(w => {
                    const status = getRelativeWeekStatus(w);
                    if (status === 'past') {
                        return 'rgba(209, 213, 219, 0.6)';
                    } else if (status === 'current') {
                        return 'rgba(251, 191, 36, 0.8)';
                    } else {
                        return 'rgba(0, 40, 85, 0.6)'; /* Deep Blue with opacity */
                    }
                });
                const borderColors = currentTrainingPlan.map(w => {
                    const status = getRelativeWeekStatus(w);
                    if (status === 'past') {
                        return 'rgba(156, 163, 175, 1)';
                    } else if (status === 'current') {
                        return 'rgba(245, 158, 11, 1)';
                    } else {
                        return 'rgba(0, 40, 85, 1)'; /* Solid Deep Blue */
                    }
                });

                const chartData = {
                    labels: labels,
                    datasets: [{
                        label: `Weekly Volume (${unit})`,
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 1,
                        borderRadius: 4,
                    }]
                };

                if (volumeChart) {
                    volumeChart.destroy();
                }

                volumeChart = new Chart(chartCanvas, {
                    type: 'bar',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return ` Volume: ${context.parsed.y} ${unit}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: `Total Weekly Volume (${unit})`
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Training Week'
                                }
                            }
                        },
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const clickedElementIndex = elements[0].index;
                                const weekNumber = clickedElementIndex + 1;
                                const clickedWeekData = currentTrainingPlan.find(w => w.week === weekNumber);
                                if (clickedWeekData) {
                                    currentPhase = clickedWeekData.phase;
                                    renderPhaseNav();
                                    renderWeekSelector();
                                    renderWeekPlan(weekNumber);
                                }
                            }
                        }
                    }
                });
            }

            unitToggle.addEventListener('change', () => {
                isMiles = unitToggle.checked;
                const dot = unitToggle.parentNode.querySelector('.dot');
                if(isMiles) {
                    dot.style.transform = 'translateX(16px)';
                } else {
                    dot.style.transform = 'translateX(0)';
                }
                renderPaceCards();
                renderChart();
                // Re-render the current week's plan to show updated distances in selected unit
                const currentWeek = parseInt(weekSelector.value);
                renderWeekPlan(currentWeek);
            });

            marathonTimeSlider.addEventListener('input', () => {
                const totalMinutes = parseInt(marathonTimeSlider.value);
                marathonTimeDisplay.textContent = formatMinutesToHMS(totalMinutes);
                
                // Recalculate paces and scale the training plan
                paces = calculatePaces(totalMinutes);
                currentTrainingPlan = getScaledTrainingPlan(totalMinutes);

                // Re-render everything that depends on paces or scaled plan
                renderPaceCards();
                renderChart();
                // Re-render the current week's plan to show updated distances
                const currentWeek = parseInt(weekSelector.value);
                renderWeekPlan(currentWeek);
            });

            weekSelector.addEventListener('change', (e) => {
                renderWeekPlan(e.target.value);
            });

            // Tab functionality
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active-tab'));
                    tabContents.forEach(content => content.classList.add('hidden'));

                    button.classList.add('active-tab');

                    const targetId = button.id.replace('tab-', 'tab-content-');
                    document.getElementById(targetId).classList.remove('hidden');
                });
            });


            // Determine current week and initialize
            function initializeApp() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                let currentWeekNumber = 1;

                // Calculate the initial scaled plan based on the default slider value
                currentTrainingPlan = getScaledTrainingPlan(parseInt(marathonTimeSlider.value));

                for (const weekData of currentTrainingPlan) {
                    const currentYear = today.getFullYear();
                    const { startDate, endDate } = parseDateRange(weekData.dates, currentYear);
                    if (today >= startDate && today <= endDate) {
                        currentWeekNumber = weekData.week;
                        break;
                    }
                    if (weekData.week === currentTrainingPlan.length && today > endDate) {
                        currentWeekNumber = currentTrainingPlan.length;
                        break;
                    }
                }
                
                const initialWeekData = currentTrainingPlan.find(w => w.week === currentWeekNumber);
                if (initialWeekData) {
                    currentPhase = initialWeekData.phase;
                }

                paces = calculatePaces(parseInt(marathonTimeSlider.value));
                marathonTimeDisplay.textContent = formatMinutesToHMS(parseInt(marathonTimeSlider.value));

                renderPaceCards();
                renderPhaseNav();
                renderWeekSelector();
                renderWeekPlan(currentWeekNumber);
                renderChart();

                // Set initial position of the toggle dot
                const initialDot = unitToggle.parentNode.querySelector('.dot');
                if (isMiles) {
                    initialDot.style.transform = 'translateX(16px)';
                } else {
                    initialDot.style.transform = 'translateX(0)';
                }
            }

            initializeApp();
        });

    </script>
</body>
</html>